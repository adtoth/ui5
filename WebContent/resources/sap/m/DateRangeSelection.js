/*!
 * SAP UI development toolkit for HTML5 (SAPUI5/OpenUI5)
 * (c) Copyright 2009-2014 SAP AG or an SAP affiliate company. 
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
jQuery.sap.declare("sap.m.DateRangeSelection");jQuery.sap.require("sap.m.library");jQuery.sap.require("sap.m.DatePicker");sap.m.DatePicker.extend("sap.m.DateRangeSelection",{metadata:{library:"sap.m",properties:{"delimiter":{type:"string",group:"Misc",defaultValue:'-'},"secondDateValue":{type:"object",group:"Data",defaultValue:null},"from":{type:"object",group:"Misc",defaultValue:null,deprecated:true},"to":{type:"object",group:"Misc",defaultValue:null,deprecated:true}},events:{"change":{}}}});sap.m.DateRangeSelection.M_EVENTS={'change':'change'};
sap.m.DateRangeSelection.prototype.init=function(){this.setProperty("valueFormat",null,true);sap.m.DatePicker.prototype.init.apply(this,arguments)};
jQuery.sap.require("sap.ui.model.type.Date");(function(){sap.m.DateRangeSelection.prototype._getPlaceholder=function(){var p=this.getPlaceholder();if(!p){p=this.getDisplayFormat();if(!p){p="medium"}if(p==="short"||p==="medium"||p==="long"){var l=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();var L=sap.ui.core.LocaleData.getInstance(l);p=L.getDatePattern(p)}if(this.getDelimiter()&&this.getDelimiter()!==""){p=p+" "+this.getDelimiter()+" "+p}}return p};sap.m.DateRangeSelection.prototype.setValue=function(v){if(v!==this.getValue()){this._lastValue=v}this.setProperty("value",v,true);this._parseValue(v);if(this.getDomRef()){var o=this._formatValue();if(this._$input.val()!==o){this._$input.val(o);this._setLabelVisibility();this._curpos=this._$input.cursorPos()}}return this};sap.m.DateRangeSelection.prototype.setFrom=function(F){this.setDateValue(F)};sap.m.DateRangeSelection.prototype.getFrom=function(){return this.getDateValue()};sap.m.DateRangeSelection.prototype.setTo=function(t){this.setSecondDateValue(t)};sap.m.DateRangeSelection.prototype.getTo=function(){return this.getSecondDateValue()};sap.m.DateRangeSelection.prototype.setDateValue=function(D){this.setProperty("dateValue",D,true);var v=this._formatValue();if(v!==this.getValue()){this._lastValue=v}this.setProperty("value",v,true);if(this.getDomRef()){var o=this._formatValue();if(this._$input.val()!==o){this._$input.val(o);this._setLabelVisibility();this._curpos=this._$input.cursorPos()}}return this};sap.m.DateRangeSelection.prototype.setSecondDateValue=function(s){this.setProperty("secondDateValue",s,true);var v=this._formatValue();if(v!==this.getValue()){this._lastValue=v}this.setProperty("value",v,true);if(this.getDomRef()){var o=this._formatValue();if(this._$input.val()!==o){this._$input.val(o);this._setLabelVisibility();this._curpos=this._$input.cursorPos()}}return this};sap.m.DateRangeSelection.prototype._parseValue=function(v){var i="";var F;var D="";if((this.getDelimiter()&&(this.getDelimiter()!==""))&&v){D=v.split(" "+this.getDelimiter()+" ")}if(((!this.getDelimiter()||(this.getDelimiter()===""))&&v)||(this.getDelimiter()&&(this.getDelimiter()!=="")&&v&&D&&(D.length===2))){i=this.getDisplayFormat();if(!i){i="medium"}if(i==="short"||i==="medium"||i==="long"){F=sap.ui.core.format.DateFormat.getInstance({style:i})}else{F=sap.ui.core.format.DateFormat.getInstance({pattern:i})}if((!this.getDelimiter()||(this.getDelimiter()===""))&&v){this.setProperty("dateValue",F.parse(v),true)}else if(D!==""){if((F.parse(D[0])===null)||(F.parse(D[1])===null)){this.setProperty("dateValue",null,true);this.setProperty("secondDateValue",null,true);this.setProperty("value",null,true)}else{this.setProperty("dateValue",F.parse(D[0]),true);this.setProperty("secondDateValue",F.parse(D[1]),true)}}}else{this.setProperty("dateValue",null,true);this.setProperty("secondDateValue",null,true);this.setProperty("value",null,true)}};sap.m.DateRangeSelection.prototype._formatValue=function(D,o){var g;var s;if(D){g=D}else{g=this.getProperty("dateValue")}if(o){s=o}else{s=this.getProperty("secondDateValue")}var v="";if(((!this.getDelimiter()||(this.getDelimiter()===""))&&g)||(this.getDelimiter()&&(this.getDelimiter()!=="")&&g&&s)){var O="";var F;O=this.getDisplayFormat();if(!O){O="medium"}if(O==="short"||O==="medium"||O==="long"){F=sap.ui.core.format.DateFormat.getInstance({style:O})}else{F=sap.ui.core.format.DateFormat.getInstance({pattern:O})}if(this.getDelimiter()&&(this.getDelimiter()!=="")){v=F.format(g)+" "+this.getDelimiter()+" "+F.format(s)}else{v=null}}return v};sap.m.DateRangeSelection.prototype.onChange=function(){var D=this.getDateValue();var s=this.getSecondDateValue();var l=this._lastValue;this._getInputValue();e(this,D,s);this._lastValue=l;var v=this._formatValue();if((v!==this._lastValue)||(v==="")){if(this.getDomRef()){this._$input.val(v)}this.setProperty("value",v,true);this._curpos=this._$input.cursorPos();this._setLabelVisibility();this._lastValue=v;if(this._oPopup&&this._oPopup.isOpen()){var S=this.getDateValue();if(S){if(!this._oDateRange.getStartDate()||this._oDateRange.getStartDate().getTime()!==S.getTime()){this._oDateRange.setStartDate(new Date(S.getTime()));this._oCalendar.focusDate(S)}}else{if(this._oDateRange.getStartDate()){this._oDateRange.setStartDate(undefined)}}var E=this.getSecondDateValue();if(E){if(!this._oDateRange.getEndDate()||this._oDateRange.getEndDate().getTime()!==E.getTime()){this._oDateRange.setEndDate(new Date(E.getTime()));this._oCalendar.focusDate(E)}}else{if(this._oDateRange.getEndDate()){this._oDateRange.setEndDate(undefined)}}}d(this)}};sap.m.DateRangeSelection.prototype._getInputValue=function(){var v=this._$input.val();this._parseValue(v);v=this._formatValue();return v};sap.m.DateRangeSelection.prototype.onclick=function(E){if(jQuery(E.target).hasClass("sapUiIcon")){var t=this;a(t)}};sap.m.DateRangeSelection.prototype.onfocusin=function(E){if(sap.ui.Device.browser.mobile){if(!jQuery(E.target).hasClass("sapUiIcon")){var t=this;a(t)}}};sap.m.DateRangeSelection.prototype.onsapshow=function(E){var t=this;a(t);E.preventDefault()};sap.m.DateRangeSelection.prototype.onsapenter=function(E){this.onChange(E)};sap.m.DateRangeSelection.prototype.onsappageup=function(){};sap.m.DateRangeSelection.prototype.onsappageupmodifiers=function(){};sap.m.DateRangeSelection.prototype.onsappagedown=function(){};sap.m.DateRangeSelection.prototype.onsappagedownmodifiers=function(){};function _(t){if(!t._oPopup){jQuery.sap.require("sap.ui.core.Popup");t._oPopup=new sap.ui.core.Popup();t._oPopup.setAutoClose(true);t._oPopup.setDurations(0,0)}if(!t._oCalendar){sap.ui.getCore().loadLibrary("sap.ui.unified");jQuery.sap.require("sap.ui.unified.library");t._oCalendar=new sap.ui.unified.Calendar(t.getId()+"-cal",{intervalSelection:true});t._oDateRange=new sap.ui.unified.DateRange();t._oCalendar.addSelectedDate(t._oDateRange);t._oCalendar.attachSelect(b,t);t._oCalendar.attachCancel(c,t);t._oPopup.setContent(t._oCalendar);if(t.$().closest(".sapUiSizeCompact").length>0){t._oCalendar.addStyleClass("sapUiSizeCompact")}t._oCalendar.setPopupMode(true);t._oCalendar.setParent(t,undefined,true)}var s=t.getDateValue();var E=t.getSecondDateValue();if(s){if(!t._oDateRange.getStartDate()||t._oDateRange.getStartDate().getTime()!==s.getTime()){t._oDateRange.setStartDate(new Date(s.getTime()))}}else{if(t._oDateRange.getStartDate()){t._oDateRange.setStartDate(undefined)}}if(E){if(!t._oDateRange.getEndDate()||t._oDateRange.getEndDate().getTime()!==E.getTime()){t._oDateRange.setEndDate(new Date(E.getTime()))}}else{if(t._oDateRange.getEndDate()){t._oDateRange.setEndDate(undefined)}}t._oPopup.setAutoCloseAreas([t.getDomRef()]);var g=sap.ui.core.Popup.Dock;var A=g.BeginBottom+"-4";t._oPopup.open(0,g.BeginTop,A,t,null,"fit",true)}function a(t){if(t.getEditable()&&t.getEnabled()){if(!t._oPopup||!t._oPopup.isOpen()){_(t)}else{t._oPopup.close()}}}function b(){var s=this._oCalendar.getSelectedDates();if(s.length>0){var D=s[0].getStartDate();var o=s[0].getEndDate();if(D&&o){var O=this._formatValue(D,o);if(this._$input.val()!==O){this._$input.val(O);this._setLabelVisibility();this._curpos=O.length;this._$input.cursorPos(this._curpos)}this._oPopup.close();this.focus();this.onChange();if(sap.ui.Device.browser.mobile){window.document.activeElement.blur()}}}}function c(){if(this._oPopup&&this._oPopup.isOpen()){this._oPopup.close();this.focus()}}function d(t){t.fireChange({from:t.getDateValue(),to:t.getSecondDateValue()})}function e(t,D,s){var g=t.getDateValue();var h=t.getSecondDateValue();if((g!==null)&&(h!==null)&&(!f(g,h))){if((D!==null)&&(g.getTime()===D.getTime())){t.setProperty("dateValue",h,true)}else if((s!==null)&&(h.getTime()===s.getTime())){t.setProperty("secondDateValue",g,true)}else{t.setProperty("secondDateValue",g,true)}}}function f(g,t){if(g.getTime()<t.getTime()){return true}return false}}());
